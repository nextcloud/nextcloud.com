/**
* DSGVO Video Embed, v1.0.1
* (c) 2018 Arndt von Lucadou
* MIT License
* https://github.com/a-v-l/dsgvo-video-embed
*/

(function() {
    // Config
    var text = {
        youtube: '<strong>Embedded YouTube-Video</strong><p class="dsgvo-text"><b>Note: </b> This embedded video is provided by YouTube, LLC, 901 Cherry Ave, San Bruno, CA 94066, USA. During playback, a connection to the Youtube servers is established. Youtube will be informed which pages you visit. If you are logged into your Youtube account, Youtube can assign your surfing behavior to you personally. You can prevent this by logging out of your YouTube account beforehand. If a Youtube video is started, the provider uses cookies that collect information about user behavior.<br><br>Whoever has deactivated the storage of cookies for the Google Ad program will also not have to reckon with such cookies when viewing YouTube videos. Youtube also stores non-personal usage information in other cookies. If you want to prevent this, you must block the saving of cookies in your browser. Further information on data protection at "Youtube" can be found in the privacy policy of the provider at: <a class="hyperlink" href="https://www.google.com/policies/privacy/" rel="noopener" target="_blank">https://www.google.com/policies/privacy/</a></p><a class="video-link hyperlink" href="https://youtu.be/%id%" rel="noopener" target="_blank" title="Watch video on YouTube">Link to video: https://youtu.be/%id%</a><button title="Watch video on this page">play video</button>',
    vimeo: '<strong>Eingebettetes Vimeo-Video</strong><div><p><b>Hinweis:</b> Dieses eingebettete Video wird von Vimeo, Inc., 555 West 18th Street, New York, New York 10011, USA bereitgestellt.<br>Beim Abspielen wird eine Verbindung zu den Servern von Vimeo hergestellt. Dabei wird Vimeo mitgeteilt, welche Seiten Sie besuchen. Wenn Sie in Ihrem Vimeo-Account eingeloggt sind, kann Vimeo Ihr Surfverhalten Ihnen persönlich zuzuordnen. Dies verhindern Sie, indem Sie sich vorher aus Ihrem Vimeo-Account ausloggen.</p><p>Wird ein Vimeo-Video gestartet, setzt der Anbieter Cookies ein, die Hinweise über das Nutzerverhalten sammeln.</p><p>Weitere Informationen zum Datenschutz bei „Vimeo“ finden Sie in der Datenschutzerklärung des Anbieters unter: <a href="https://vimeo.com/privacy" rel="noopener" target="_blank">https://vimeo.com/privacy</a></p></div><a class="video-link" href="https://vimeo.com/%id%" rel="noopener" target="_blank" title="Video auf Vimeo ansehen">Link zum Video: https://vimeo.com/%id%</a><button title="Video auf dieser Seite ansehen">Video abspielen</button>'
       };
       window.video_iframes = [];
       document.addEventListener("DOMContentLoaded", function() {
           var video_frame, wall, video_platform, video_src, video_id, video_w, video_h;
           for (var i=0, max = window.frames.length - 1; i <= max; i+=1) {
               video_frame = document.getElementsByTagName('iframe')[0];
               video_w = video_frame.getAttribute('width');
               video_h = video_frame.getAttribute('height');
               video_iframes.push(video_frame);
               wall = document.createElement('article');
               // Only proccess video iframes [youtube|vimeo]
               if (video_frame.src.match(/youtube|vimeo/) == null) {
                   continue;
               }
               // Prevent iframes from loading remote content
               if(navigator.appName == 'Microsoft Internet Explorer') {
                   window.frames[0].document.execCommand('Stop');
               } else {
                   window.frames[0].stop();
               }
               video_platform = video_frame.src.match(/vimeo/) == null ? 'youtube' : 'vimeo';
               video_id = video_frame.src.match(/(embed|video)\/([^?\s]*)/)[2];
               wall.setAttribute('class', 'video-wall');
               wall.setAttribute('data-index', i);
               if (video_w && video_h) {
                    if(window.location.href.indexOf("blog") > -1 || window.location.href.indexOf("industries") > -1 ||        window.location.href.indexOf("press") > -1 || window.location.href.indexOf("events") > -1 || window.location.href.indexOf("enterprise") > -1 ) {
                        wall.setAttribute('style', 'width:'+video_w+'px;height:'+video_h+'px;'+'background-image: url("../../media/'+video_id+'.jpg");');
                    } else {
                        wall.setAttribute('style', 'width:'+video_w+'px;height:'+video_h+'px;'+'background-image: url("../media/'+video_id+'.jpg");');
                    }
               }
               wall.innerHTML = text[video_platform].replace(/\%id\%/g, video_id);
               video_frame.parentNode.replaceChild(wall, video_frame);
               document.querySelectorAll('.video-wall button')[i].addEventListener('click', function() {
                   var video_frame = this.parentNode,
                   index = video_frame.getAttribute('data-index');
                   video_iframes[index].src = video_iframes[index].src.replace(/www\.youtube\.com/, 'www.youtube-nocookie.com');
                   video_frame.parentNode.replaceChild(video_iframes[index], video_frame);
               }, false);
           }
       });
   })();
